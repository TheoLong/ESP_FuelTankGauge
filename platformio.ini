; PlatformIO Project Configuration File
; ESP_FuelTankGauge - Dual Fuel Tank Gauge for ESP32-C6-LCD-1.9
;
; Build: pio run
; Upload: Download .bin and use web flasher
; Test: pio test -e native

[platformio]
default_envs = esp32c6

;------------------------------------------------------------------------------
; ESP32-C6 Target Environment
; Using Arduino ESP32 3.x with proper ESP32-C6 support
;------------------------------------------------------------------------------
[env:esp32c6]
platform = https://github.com/tasmota/platform-espressif32/releases/download/2024.08.10/platform-espressif32.zip
board = esp32-c6-devkitc-1
framework = arduino

; Build settings - Enable USB CDC for serial output over USB
build_flags = 
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DCORE_DEBUG_LEVEL=4
    -I src

; Monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, colorize

; Upload settings - auto-detect port
upload_speed = 921600

; Libraries - use LovyanGFX which has better ESP32-C6 support
lib_deps = 
    lovyan03/LovyanGFX@^1.2.0

; Flash settings
board_build.flash_mode = dio
board_build.flash_size = 8MB

;------------------------------------------------------------------------------
; Native Environment for Unit Tests
;------------------------------------------------------------------------------
[env:native]
platform = native
build_flags = 
    -DUNIT_TEST
    -DNATIVE_BUILD
    -I src
    -std=c++11

; Test framework
test_framework = unity
test_ignore = test_embedded

; Exclude main.cpp and Arduino-specific files from native build
build_src_filter =
    +<*>
    -<main.cpp>

lib_deps =

;------------------------------------------------------------------------------
; Common settings
;------------------------------------------------------------------------------
[env]
test_build_src = yes
